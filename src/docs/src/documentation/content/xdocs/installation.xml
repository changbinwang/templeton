<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">

<document>
  <header>
    <title>Installation </title>
  </header>
  <body>

  <section>
  <title>Introduction </title> 
  <p>Templeton is deep in the middle of development and does not yet have a smooth 
     install procedure. As such, this version of Templeton should only be installed expert
     developers.</p>
  </section>

  <section>
  <title>Requirements</title>  
  <ul>
   <li><a href="http://ant.apache.org/">Ant</a>, version 1.8 or higher</li>
   <li><a href="http://tomcat.apache.org/">Tomcat</a>, version 7.0 or higher</li>
   <li><a href="http://hadoop.apache.org/">Hadoop</a>, version 0.20.203.0</li>
   <li><a href="http://incubator.apache.org/hcatalog/">HCatalog</a></li>
  </ul>
  <p><strong>Note:</strong> To run the dll api call, HCatalog must be installed in
    <code>/usr/local/hcat/bin/hcat</code>.</p>
  </section>

  <section>
  <title>Environment variables</title>
  <table>
  <tr><th>Variable</th><th>Value</th></tr>
  <tr><td><code>HADOOP_HOME</code></td>
      <td>Set to the location of your Hadoop install</td>
  </tr>
  <tr><td><code>CATALINA_HOME</code></td>
      <td>Set to the location of your Tomcat install</td>
  </tr>

  <tr><td><code>TEMPLETON_HOME</code></td>
      <td>Set to the Templeton directory</td>
  </tr>

  <tr><td><code>TEMPLETON_JAR</code></td>
      <td>Set to the location of the Templeton jar file. 
          After a build the location will be 
          <code>TEMPLETON_HOME/build/templeton/templeton-0.1.0.jar.</code></td>
  </tr>
  </table>
  </section>
 
  <section>
  <title>Procedure</title>
  <ol>
  <li>Ensure that the required related installations and environment 
      variables are in place.</li>
  <li>Start Tomcat.</li>
  <li>Build and install the Templeton war file using <code>ant install -war</code>
      from <code>$TEMPLETON_HOME</code>.  The Tomcat webapps directory must be writable.</li>
  <li>Check that your local install works.  Assuming that Tomcat is running
      on port 8080, use: 
<source>
curl -i http://localhost:8080/templeton/v1/status.json
</source>
      Typical output is:
<source>
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: application/json
Transfer-Encoding: chunked
Date: Tue, 18 Oct 2011 19:35:17 GMT

{"status": "ok", "version": "v1"}
</source></li>
  </ol>
  </section>

  <section>
  <title>Authentification</title>
  <p>To run any of the authenticated API calls, sudo must be setup properly.</p>
  <p><strong>For Development</strong> you can simply:</p>
  <ol>
  <li>Run Tomcat as yourself.</li>
  <li>Make sure that you can sudo as yourself.  For example,
     <code>sudo -u $USER date </code></li>
  </ol>
  <p><strong>For Production</strong> you likely want to set up special user.</p>
  <ol>
  <li>Create a user group containing the owners of API call programs the 
      Templeton API will wish to call. Let's call our owner group "hadoop".</li>
  <li>As root, edit the sudoers file and add the following line:
<source>
runner ALL=(%hadoop) NOPASSWD: command1[,command2, ...]
</source>
      This allows user "runner" to run the commands listed if they are owned by
      a user in the group "hadoop". 
  </li>
  </ol>
  </section>
  </body>
</document>
