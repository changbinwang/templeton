<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">

<document>
  <header>
    <title>Installation </title>
  </header>
  <body>

  <section>
  <title>Introduction </title> 
  <p>Templeton is deep in the middle of development and does not yet have a smooth 
     install procedure. It is also designed to connect together services that are 
     not normally connected and therefore has a complex configuration.  As such, 
     this version of Templeton should only be installed by expert developers.</p>
  </section>

  <section>
  <title>Requirements</title>  
  <ul>
   <li><a href="http://ant.apache.org/">Ant</a>, version 1.8 or higher</li>
   <li><a href="http://tomcat.apache.org/">Tomcat</a>, version 7.0 or higher</li>
   <li><a href="http://hadoop.apache.org/">Hadoop</a>, version 0.20.205.0</li>
   <li><a href="http://zookeeper.apache.org/">ZooKeeper</a>.  (Be sure to review
    and update the ZooKeeper related <a href="configuration.html">Templeton 
    configuration</a> as required.)</li>
   <li><a href="http://incubator.apache.org/hcatalog/">HCatalog</a>, To use the 
    ddl resource, HCatalog must be installed in 
    <code>/usr/local/hcat/bin/hcat</code></li>
   <li><a href="installation.html#Hadoop+Distributed+Cache">Hadoop Distributed Cache</a>,
    To use the <a href="http://hive.apache.org/">Hive</a>, 
    <a href="http://pig.apache.org/">Pig</a>, or 
    <a href="http://hadoop.apache.org/common/docs/r1.0.0/streaming.html">hadoop/streaming</a> 
    resources, see instructions below for placing the required files in the 
    Hadoop Distributed Cache.</li>
  </ul>
  </section>
 
  <section>
  <title>Procedure</title>
  <ol>
  <li>Ensure that the required related installations are in place.</li>
  <li>Set the <code>TEMPLETON_HOME</code> environment variable to the base of the
      Templeton installation.  This is used to find the Templeton 
      configuration.</li>
  <li>Review the <a href="configuration.html">Templeton configuration</a> 
      and update <code>templeton-site.xml</code> as required. Ensure that 
      site specific component installation locations are accurate, especially
      the Hadoop configuration path.  Configuration variables that use a filesystem
      path try to have reasonable defaults, but it's always safe to specify a full 
      and complete path.</li>
  <li>Start Tomcat.</li>
  <li>Build and install the Templeton war file using <code>ant install-war</code>
      from <code>$TEMPLETON_HOME</code>.  The Tomcat webapps directory must be writable.</li>
  <li>Check that your local install works.  Assuming that Tomcat is running
      on port 8080, the following command would give output similar to that shown. 
<source>
% curl -i http://localhost:8080/templeton/v1/status.json
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: application/json
Transfer-Encoding: chunked
Date: Tue, 18 Oct 2011 19:35:17 GMT

{"status": "ok", "version": "v1"}
%
</source></li>
  </ol>
  </section>

  <section>
  <title>Authentication</title>
  <p>To run any of the authenticated API calls, sudo must be setup properly.</p>
  <p><strong>For Development</strong></p>
  <ol>
  <li>Run Tomcat as yourself.</li>
  <li>Make sure that you can sudo as yourself.  For example,
     <code>sudo -u $USER date </code></li>
  </ol>
  <p><strong>For Production</strong></p>
  <ol>
  <li>Create user runner with permission to run the required commands.  In the sudoers file:
<source>
runner ALL=(%hadoop) NOPASSWD: command1[,command2, ...]
</source>
      allows runner to run the commands if they are owned by
      a user in the group hadoop. 
  </li>
  <li>Run Tomcat as runner.</li>
  </ol>
  </section>

  <section>
  <title>Hadoop Distributed Cache</title>
  <p>Templeton requires some files be accessible on the 
  <a href="http://hadoop.apache.org/common/docs/current/mapred_tutorial.html#DistributedCache">
   Hadoop distributed cache</a>.  For example, to avoid the installation of Pig and Hive 
   everywhere on the cluster, Templeton gathers a version of Pig or Hive from the 
   Hadoop distributed cache whenever those resources are invoked. To install the 
   required components in the locations specificed by the default configuration, 
   follow these steps:</p>
  
  <ol>
  <li>Create <code>hive.tar</code>.  If you installed HCatalog as noted above, this 
      this is done as follows:
<source>
cd /usr/local/hcat
tar cf /tmp/hive.tar .
</source>
  </li>
  <li>Place <code>hive.tar</code> into the cache.
<source>
hadoop fs -put /tmp/hive.tar /user/templeton/hive.tar
</source>
  </li>
  <li>Install Pig locally, for example in <code>/usr/local/pig</code>.</li>
  <li>Create <code>pig.tar</code>:
<source>
cd /usr/local/pig
tar cf /tmp/pig.tar .
</source>
  </li>
  <li>Place <code>pig.tar</code> into the cache.
<source>
hadoop fs -put /tmp/pig.tar /user/templeton/pig.tar
</source>
  </li>
  <li>Place <code>hadoop-streaming.jar</code> into the cache.
<source>
hadoop fs -put hadoop-streaming.jar /user/templeton/hadoop-streaming.jar
</source>
  </li>
  </ol>

  <p>The location of these files in the cache, and the location 
     of the installations inside the archives, can be specified using the following 
     Templeton configuration variables.  (See the 
     <a href="configuration.html">Configuration</a> documentation for more information
     on changing Templeton configuration parameters.)</p> 

  <table>
  <tr><th>Name</th><th>Default</th><th>Description</th></tr>

  <tr>
    <td><strong>templeton.pig.archive</strong></td>
    <td><code>hdfs:///user/templeton/pig.tar</code></td>
    <td>The path to the Pig archive.</td>
  </tr>

  <tr>
    <td><strong>templeton.pig.path</strong></td>
    <td><code>pig.tar/bin/pig</code></td>
    <td>The path to the Pig executable.</td>
  </tr>

  <tr>
    <td><strong>templeton.hive.archive</strong></td>
    <td><code>hdfs:///user/templeton/hive.tar</code></td>
    <td>The path to the Hive archive.</td>
  </tr>

  <tr>
    <td><strong>templeton.hive.path</strong></td>
    <td><code>hive.tar/bin/hive</code></td>
    <td>The path to the Hive executable.</td>
  </tr>

  <tr>
    <td><strong>templeton.streaming.jar</strong></td>
    <td><code>hdfs:///user/templeton/hadoop-streaming.jar</code></td>
    <td>The path to the Hadoop streaming jar file.</td>
  </tr>
  </table>
  </section>

  </body>
</document>
