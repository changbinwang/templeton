###############################################################################
# curl command tests for templeton
#
#

#use Yahoo::Miners::Test::PigSetup;

#PigSetup::setup();

#my $me = `whoami`;
#chomp $me;

$cfg = 
{
 'driver' => 'Curl',

 'groups' => 
 [

##=============================================================================================================
  {
   'name' => 'DB_OPS',
   'tests' => 
   [
    {
     #check if db created by UNAME_OTHER is visible for user UNAME
     'num' => 1,

     'prepare_method' => 'PUT',
     'prepare_url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_a',
     'prepare_user_name' => ':UNAME_OTHER:',
     'prepare_format_header' => 'Content-Type: application/json',
     'prepare_post_options' => ['{"comment":"Hello there", "properties":{"a":"b"}}'],


     'method' => 'GET',
     'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/',
     'user_name' => ':UNAME:',

     'format_header' => 'Content-Type: application/json',
     'json_field_substr_match' => {'databases' => 'hcatperms_a'},

     'status_code' => 200,
    },


    {

     #check if group id is set as per spec
     'num' => 2,

     'prepare_method' => 'PUT',
     'prepare_post_options' => [
             '{"ifNotExists": "true",
               "permissions" : "rwxrwxrwx", 
               "group" : ":UGROUP:"
               }'
      ],
     'prepare_format_header' => 'Content-Type: application/json',
     'prepare_url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_b',
     'prepare_user_name' => ':UNAME:',


     'method' => 'GET',
     'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_b',
     'user_name' => ':UNAME:',

     #TODO - check permissions field once GET :table starts returning those
     'format_header' => 'Content-Type: application/json',
     'json_field_substr_match' => {'location_perms' => 'rwxrwxrwx', 'location_group' => ':UGROUP:'},
     'status_code' => 200,
    },

    {

     #check if group id is set as per spec
     'num' => 3,

     'prepare_method' => 'PUT',
     'prepare_post_options' => [
             '{"ifNotExists": "true",
               "permissions" : "r-xr-x---", 
               "group" : ":UGROUP:"
               }'
      ],
               
     'prepare_url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_c',
     'prepare_user_name' => ':UNAME:',
     'prepare_format_header' => 'Content-Type: application/json',
     'prepare_post_options' => ['{"comment":"Hello there", "location":"", "properties":{"a":"b"}}'],

     'method' => 'GET',
     'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_c',
     'user_name' => ':UNAME:',

     #TODO - check permissions field once GET :table starts returning those
     'format_header' => 'Content-Type: application/json',
     'json_field_substr_match' => {'location_perms' => 'r-xr-x---', 'location_group' => ':UGROUP:'},
     'status_code' => 200,
    },


    {

     #check if user belonging to same group is able to access
     'num' => 4,

     'prepare_method' => 'PUT',
     'prepare_post_options' => [
             '{"ifNotExists": "true",
               "permissions" : "r-xr-x---", 
               "group" : ":UGROUP:"
               }'
      ],
               
     'prepare_url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_d',
     'prepare_user_name' => ':UNAME:',
     'prepare_format_header' => 'Content-Type: application/json',
     'prepare_post_options' => ['{"comment":"Hello there", "location":"", "properties":{"a":"b"}}'],


     'method' => 'GET',
     'url' => ':TEMPLETON_URL:/templeton/v1/ddl/database/hcatperms_d',
     'user_name' => ':UNAME_GROUP:',

     #TODO - check permissions field once GET :table starts returning those
     'format_header' => 'Content-Type: application/json',
     'json_field_substr_match' => {'location_perms' => 'r-xr-x---', 'location_group' => ':UGROUP:'},
     'status_code' => 200,
    },

   ]
  },

##=============================================================================================================





 ]
},
  ;

